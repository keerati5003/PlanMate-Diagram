@startuml
actor User
participant "UI (Focus Mode Page)" as FE
database "Firebase Realtime DB" as FB

User -> FE : Call subscribeToFriends(rawGroupIds, currentUserId)
activate User
activate FE

FE -> FE : normalizeGroups(rawGroupIds) â†’ groupIds

loop For each groupId
  FE -> FB : Subscribe activeGroups/{groupId}
  activate FB
  FB --> FE : Members snapshot
  deactivate FB

  FE -> FE : Filter out currentUserId\nUpdate groupMembers[groupId]

  FE -> FE : Build union of all members across groups

  FE -> FE : Sync onlineFriends list\n(create if missing)

  loop For each member UID
    FE -> FB : Subscribe activeUsers/{uid}
    activate FB
    FB --> FE : User data (name, image, focusSessionId)
    deactivate FB
  end
end

FE -> User : Online Friends List updated reactively
deactivate FE
deactivate User
@enduml
