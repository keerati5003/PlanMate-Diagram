@startuml
actor User
participant "UI" as FE
participant "API" as C
participant "Service" as S
database "Database" as DB
database "Firebase Realtime DB" as FB

' --- Start ---

User -> FE : Select session â†’ Start Focus
activate User
activate FE
FE -> C : POST /focus/{sessionId}/start
deactivate FE
activate C
C -> S : startFocusSession(sessionId)
activate S
S -> DB : Save FocusSession (status=FOCUSING)
activate DB
DB --> S : OK
deactivate DB
S -> FB : Publish FocusSession (status=FOCUSING)
activate FB
FB --> S : ACK
deactivate FB
S --> C : FocusSessionDTO
deactivate S
C --> FE : 200 OK + focusSessionId
deactivate C
activate FE
FE -> User : Navigate to Focus Mode


' --- Load Active ---
FE -> C : GET /focus/active
deactivate FE
activate C
C -> S : getActiveFocusSession(userUid)
activate S
S -> DB : Query active/paused session
activate DB
DB --> S : FocusSessionDTO
deactivate DB
S --> C : FocusSessionDTO
deactivate S
C --> FE : Active session info
deactivate C
activate FE
FE -> User : Show timer (FOCUSING / controls)
deactivate FE

' --- Pause ---
User -> FE : Click "Pause"
activate FE
FE -> C : POST /focus/{id}/pause
deactivate FE
activate C
C -> S : pauseFocusSession(id)
activate S
S -> DB : Update status=PAUSED, elapsed
activate DB
DB --> S : OK
deactivate DB
S -> FB : Update session (status=PAUSED)
activate FB
FB --> S : ACK
deactivate FB
S --> C : FocusSessionDTO
deactivate S
C --> FE : 200 OK
deactivate C
activate FE
FE -> User : Show Paused
deactivate FE

' --- Resume ---
User -> FE : Click "Resume"
activate FE
FE -> C : POST /focus/{id}/resume
deactivate FE
activate C
C -> S : resumeFocusSession(id)
activate S
S -> DB : Update status=FOCUSING
activate DB
DB --> S : OK
deactivate DB
S -> FB : Update session (status=FOCUSING)
activate FB
FB --> S : ACK
deactivate FB
S --> C : FocusSessionDTO
deactivate S
C --> FE : 200 OK
deactivate C
activate FE
FE -> User : Timer resumes
deactivate FE

' --- End ---
User -> FE : Click "End Session"
activate FE
FE -> C : POST /focus/{id}/end
deactivate FE
activate C
C -> S : endFocusSession(id)
activate S
S -> DB : Finalize (elapsed, status=COMPLETED)
activate DB
DB --> S : OK
deactivate DB
S -> FB : Clear focus session
activate FB
FB --> S : ACK
deactivate FB
S --> C : FocusSessionDTO (COMPLETED)
deactivate S
C --> FE : 200 OK + summary
deactivate C
activate FE
FE -> User : Show summary & stats
deactivate FE
deactivate User

@enduml